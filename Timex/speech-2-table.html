<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="application-name" content="speech-2-table" />
      <meta name content="Speech-2-Table" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
      <style>
         @keyframes pulse {
         0% {
         background-color: aliceblue;
         }
         50% {
         background-color: lightblue;
         }
         100% {
         background-color: aliceblue;
         }
         }
         .highlighted {
         background-color: aliceblue;
         }
         .recording::before {
         content: "\f130"; /* Unicode for microphone icon in Font Awesome */
         font-family: "Font Awesome 5 Free"; /* Font family for Font Awesome */
         font-weight: 900; /* Font weight for Font Awesome */
         margin-right: 5px; /* Space between the icon and the text */
         animation: pulse 1s infinite;
         color: darkred;
         }
         .recording {
         animation: pulse 1s infinite;
         }
         .typing::before {
         /* Unicode for pencil icon in Font Awesome */
         content: "\f11c";
         font-family: "Font Awesome 5 Free"; /* Font family for Font Awesome */
         font-weight: 900; /* Font weight for Font Awesome */
         margin-right: 5px; /* Space between the icon and the text */
         animation: pulse 1s infinite;
         color: black;
         }
         .typing {
         animation: pulse 1s infinite;
         }
         #table_1 tr td:nth-last-child(n + 6) {
         background-color: rgb(227, 227, 227);
         color: rgb(67, 66, 66);
         }
         #table_1 tr td:nth-last-child(-n + 5) {
         /* bold font */
         font-weight: bold;
         }
      </style>
   </head>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
   <body id="home">
      <header class="constant-bg black"></header>
      <section id="demo-slider">
         <div class="container">
            <div class="section_table">
               <div class="display-results">
                  <div class="table-area table-fit">
                     <div class="row form-inline">
                        <div class="col-lg-2 col-md-2" id="table_idx">
                           <b>Table #:</b> 1
                        </div>
                        <label for="voiceInputToggle">Use voice input: &nbsp;</label>
                        <input type="checkbox" id="voiceInputToggle" checked>
                        <div class="col-lg-2 col-md-2 div_language">
                           <select id="select_language" onchange="updateCountry()"></select>
                           <select id="select_dialect"></select>
                        </div>
                        <div class="col-lg-2 col-md-2 ml-auto">
                           <button
                              class="badge badge-dark float-right"
                              id="export-btn"
                              data-clipboard-target="#table_1"
                              onclick="copyTableToClipboard()"
                              >
                           Copy To Clipboard
                           </button>
                        </div>
                     </div>
                     <div>
                        <div class="row justify-content-center">
                           <table
                              class="table table-bordered table-hover"
                              id="table_1"
                              contenteditable="false"
                              >
                              <tbody>
                                 <tr>
                                    <td>Repare</td>
                                    <td>
                                       Caractéristiques
                                    </td>
                                    <td>
                                       Intervalle de tolérance
                                    </td>
                                    <td>
                                       Ecart Inferieur
                                    </td>
                                    <td>
                                       Ecart Superieur
                                    </td>
                                    <td>Mesure</td>
                                    <td>Mesure</td>
                                    <td>Mesure</td>
                                    <td>Mesure</td>
                                    <td>Mesure</td>
                                 </tr>
                                 <tr>
                                    <td>020</td>
                                    <td colspan="4">
                                       Pieces exempte de bavure, de copeau et de pollution
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                 </tr>
                                 <tr>
                                    <td>868-870- 872</td>
                                    <td colspan="4">
                                       Aucun bourrelet admis sur le perçage Ch.0 Max.x45 autorise
                                    </td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>120-814 806-</td>
                                    <td>Ra 0,4</td>
                                    <td></td>
                                    <td>0,000</td>
                                    <td>0,400</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>108-802- 826</td>
                                    <td>Re 0,8</td>
                                    <td></td>
                                    <td>0,000</td>
                                    <td>0,800</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>208</td>
                                    <td>3,990</td>
                                    <td>01-20</td>
                                    <td class="min">3,970</td>
                                    <td class="max">3,990</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>200</td>
                                    <td>4,990</td>
                                    <td>0/-20</td>
                                    <td class="min">4,970</td>
                                    <td class="max">4,990</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>206</td>
                                    <td>5,990</td>
                                    <td>0/-20</td>
                                    <td class="min">5,970</td>
                                    <td class="max">5,990</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>204</td>
                                    <td>7,000</td>
                                    <td>+50/-20</td>
                                    <td class="min">5,980</td>
                                    <td class="max">7,050</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>202</td>
                                    <td>@7,990</td>
                                    <td>01-15</td>
                                    <td class="min">7,975</td>
                                    <td class="max">7,990</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>210</td>
                                    <td>03,150</td>
                                    <td>+50/0</td>
                                    <td>3,150</td>
                                    <td>3,200</td>
                                    <td>Ok</td>
                                    <td>NOK</td>
                                    <td>NOK</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>212</td>
                                    <td>21,000</td>
                                    <td>+30/0</td>
                                    <td>1,000</td>
                                    <td>1,030</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>230</td>
                                    <td>00,900</td>
                                    <td>*100</td>
                                    <td>0,800</td>
                                    <td>1,000</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>216</td>
                                    <td>20,900</td>
                                    <td>+100/0</td>
                                    <td>0</td>
                                    <td>1,000</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>218</td>
                                    <td>21,500</td>
                                    <td>100</td>
                                    <td>1,400</td>
                                    <td>1,600</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                    <td>Ok</td>
                                 </tr>
                                 <tr>
                                    <td>520</td>
                                    <td>15,300</td>
                                    <td>+100/0</td>
                                    <td class="min">15,300</td>
                                    <td class="max">15,400</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>524</td>
                                    <td>0,400</td>
                                    <td>01-50</td>
                                    <td class="min">0,350</td>
                                    <td class="max">0,400</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>510</td>
                                    <td>1,500</td>
                                    <td>+500/0</td>
                                    <td class="min">1,500</td>
                                    <td class="max">2,000</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>516</td>
                                    <td>6,100</td>
                                    <td>06-50</td>
                                    <td class="min">6,050</td>
                                    <td class="max">6,100</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>514</td>
                                    <td>5,900</td>
                                    <td>+30/0</td>
                                    <td class="min">5,900</td>
                                    <td class="max">5,930</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>512</td>
                                    <td>4,900</td>
                                    <td>+30/0</td>
                                    <td class="min">4,900</td>
                                    <td class="max">4,930</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>512</td>
                                    <td>4,900</td>
                                    <td>+30/0</td>
                                    <td class="min">4,900</td>
                                    <td class="max">4,930</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>512</td>
                                    <td>4,900</td>
                                    <td>+30/0</td>
                                    <td class="min">4,900</td>
                                    <td class="max">4,930</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>500</td>
                                    <td>24,600</td>
                                    <td>0/-200</td>
                                    <td class="min">24,400</td>
                                    <td class="max">24,600</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>502</td>
                                    <td>16,800</td>
                                    <td>#20</td>
                                    <td class="min">16,780</td>
                                    <td class="max">16,820</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>522</td>
                                    <td>17,800</td>
                                    <td>+20</td>
                                    <td class="min">17,780</td>
                                    <td class="max">17,820</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>538</td>
                                    <td>5,000</td>
                                    <td>+20/0</td>
                                    <td class="min">5,000</td>
                                    <td class="max">5,020</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>500</td>
                                    <td>Ch.0,200 45</td>
                                    <td>#50</td>
                                    <td class="min">0,150</td>
                                    <td class="max">0</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>504</td>
                                    <td>
                                       Ch.0,300 x 45'
                                    </td>
                                    <td>#50</td>
                                    <td class="min">0</td>
                                    <td class="max">0,350</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>518</td>
                                    <td>6,700</td>
                                    <td>*200/0</td>
                                    <td class="min">6,700</td>
                                    <td class="max">6,900</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                                 <tr>
                                    <td>508</td>
                                    <td>0</td>
                                    <td>#100</td>
                                    <td class="min">0,800</td>
                                    <td class="max">1,000</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                     </div>
                     <br />
                  </div>
               </div>
            </div>
            <script>
               var langs = [
                ['Afrikaans', ['af-ZA']],
                ['Bahasa Indonesia', ['id-ID']],
                ['Bahasa Melayu', ['ms-MY']],
                ['Català', ['ca-ES']],
                ['Čeština', ['cs-CZ']],
                ['Deutsch', ['de-DE']],
                ['English', ['en-AU', 'Australia'],
                    ['en-CA', 'Canada'],
                    ['en-IN', 'India'],
                    ['en-NZ', 'New Zealand'],
                    ['en-ZA', 'South Africa'],
                    ['en-GB', 'United Kingdom'],
                    ['en-US', 'United States']
                ],
                ['Español', ['es-AR', 'Argentina'],
                    ['es-BO', 'Bolivia'],
                    ['es-CL', 'Chile'],
                    ['es-CO', 'Colombia'],
                    ['es-CR', 'Costa Rica'],
                    ['es-EC', 'Ecuador'],
                    ['es-SV', 'El Salvador'],
                    ['es-ES', 'España'],
                    ['es-US', 'Estados Unidos'],
                    ['es-GT', 'Guatemala'],
                    ['es-HN', 'Honduras'],
                    ['es-MX', 'México'],
                    ['es-NI', 'Nicaragua'],
                    ['es-PA', 'Panamá'],
                    ['es-PY', 'Paraguay'],
                    ['es-PE', 'Perú'],
                    ['es-PR', 'Puerto Rico'],
                    ['es-DO', 'República Dominicana'],
                    ['es-UY', 'Uruguay'],
                    ['es-VE', 'Venezuela']
                ],
                ['Euskara', ['eu-ES']],
                ['Français', ['fr-FR']],
                ['Galego', ['gl-ES']],
                ['Hrvatski', ['hr_HR']],
                ['IsiZulu', ['zu-ZA']],
                ['Íslenska', ['is-IS']],
                ['Italiano', ['it-IT', 'Italia'],
                    ['it-CH', 'Svizzera']
                ],
                ['Magyar', ['hu-HU']],
                ['Nederlands', ['nl-NL']],
                ['Norsk bokmål', ['nb-NO']],
                ['Polski', ['pl-PL']],
                ['Português', ['pt-BR', 'Brasil'],
                    ['pt-PT', 'Portugal']
                ],
                ['Română', ['ro-RO']],
                ['Slovenčina', ['sk-SK']],
                ['Suomi', ['fi-FI']],
                ['Svenska', ['sv-SE']],
                ['Türkçe', ['tr-TR']],
                ['български', ['bg-BG']],
                ['Pусский', ['ru-RU']],
                ['Српски', ['sr-RS']],
                ['한국어', ['ko-KR']],
                ['中文', ['cmn-Hans-CN', '普通话 (中国大陆)'],
                    ['cmn-Hans-HK', '普通话 (香港)'],
                    ['cmn-Hant-TW', '中文 (台灣)'],
                    ['yue-Hant-HK', '粵語 (香港)']
                ],
                ['日本語', ['ja-JP']],
                ['Lingua latīna', ['la']]
            ];

            for (var i = 0; i < langs.length; i++) {
                select_language.options[i] = new Option(langs[i][0], i);
            }
            select_language.selectedIndex = 9;
            updateCountry();
            select_dialect.selectedIndex = 0;

            function updateCountry() {
                for (var i = select_dialect.options.length - 1; i >= 0; i--) {
                    select_dialect.remove(i);
                }
                var list = langs[select_language.selectedIndex];
                for (var i = 1; i < list.length; i++) {
                    select_dialect.options.add(new Option(list[i][1], list[i][0]));
                }
                select_dialect.style.visibility = list[1].length == 1 ? 'hidden' : 'visible';
            }

            function copyTableToClipboard() {
                var table = document.getElementById("table_1");
                var range = document.createRange();
                range.selectNode(table);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand("copy");
                window.getSelection().removeAllRanges();
            }
            var final_transcript = "";
            var recognizing = false;
            var selected_cell = null;

            if (!("webkitSpeechRecognition" in window)) {
                upgrade();
            } else {
                var recognition = new webkitSpeechRecognition();

                recognition.continuous = true;
                recognition.interimResults = true;

                recognition.onstart = function() {
                    recognizing = true;
                };

                recognition.onerror = function(event) {
                    console.log(event.error);
                };

                recognition.onend = function() {
                    recognizing = false;
                };

                recognition.onresult = function(event) {
                    var interim_transcript = "";
                    for (var i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            final_transcript += event.results[i][0].transcript;
                            final_transcript = capitalize(final_transcript);
                            selected_cell.innerHTML = linebreak(final_transcript);
                            setCellState(selected_cell, "highlighted");
                            endDictation();
                        } else {
                            interim_transcript += event.results[i][0].transcript;
                            interim_transcript = capitalize(final_transcript);
                            selected_cell.innerHTML = linebreak(interim_transcript);
                        }
                    }
                };
            }

            var two_line = /\n\n/g;
            var one_line = /\n/g;

            function linebreak(s) {
                return s.replace(two_line, "<p></p>").replace(one_line, "<br>");
            }

            function capitalize(s) {
                return s.replace(s.substr(0, 1), function(m) {
                    return m.toUpperCase();
                });
            }

            function endDictation() {
                if (recognizing) {
                    recognition.stop();
                }
                recognizing = false;
            }

            function startDictation() {
                if (recognizing) return;
                recognition.lang = select_dialect.value;
                recognizing = true;
                recognition.start();
            }

            function setCellState(cell, state)
            {
               if (selected_cell) console.log(selected_cell, state)
               if (cell == null) return;
               if (cell != selected_cell && selected_cell) setCellState(selected_cell, "idle");

               validateInputRanges()

               cell.classList.remove("recording");
               cell.classList.remove("typing");

               switch(state)
               {
                  case "voice_editing":
                     cell.classList.add("recording");

                     final_transcript = "";
                     interim_transcript = "";
                     cell.innerHTML = "...";
                     selected_cell = cell;

                     startDictation();

                     break;
                  case "typing":
                     cell.classList.add("typing");

                     if (cell.innerHTML == "..." || cell.innerHTML == "-") cell.innerHTML = "";
                     selected_cell = cell;
                     
                     cell.contentEditable = true;

                     break;
                  case "highlighted":
                     cell.classList.add("highlighted");
                     if (cell.innerHTML == "..." || cell.innerHTML == "") cell.innerHTML = "-";

                     selected_cell = cell;

                     break;
                  case "idle":
                  default:
                    cell.classList.remove("highlighted");
                     if (cell.innerHTML == "..." || cell.innerHTML == "") cell.innerHTML = "-";

                    selected_cell = null;

                    break;
               }

            }

            // Validate the input ranges based on the min and max values in the table
            function validateInputRanges() {
                var rows = document.querySelectorAll('#table_1 tr');
                var min, max;
                rows.forEach(function(row) {
                    min = null;
                    max = null;
                    // Find the min and max cells in the row
                    var cells = row.querySelectorAll('td');
                    for (var i = 0; i < cells.length; i++) {
                        if (cells[i].classList.contains('min')) {
                            min = cells[i];
                        }
                        if (cells[i].classList.contains('max')) {
                            max = cells[i];
                        }
                    }

                    if (min != null && max != null) {
                        // Check if the last 5 cells are above or below the min and max values
                        var cells = row.querySelectorAll('td');
                        for (var i = cells.length - 6; i < cells.length; i++) {
                            if (cells[i].innerHTML != '-' && (parseFloat(cells[i].innerHTML.replace(',', '.')) < parseFloat(min.innerHTML.replace(',', '.')) || parseFloat(cells[i].innerHTML.replace(',', '.')) > parseFloat(max.innerHTML.replace(',', '.')))) {
                                cells[i].style.color = 'darkred';
                            }
                        }

                    }
                });
            }

            window.onload = function() {

                recognizing = false;
                selected_cell = null;
                var cells = document.querySelectorAll("#table_1 td");

                cells.forEach(function(cell) {
                    cell.addEventListener("mousedown", function() {
                        if (recognizing) endDictation();

                        // Check if user wants to use voice input or typing
                        var useVoiceInput = document.getElementById('voiceInputToggle').checked;

                        if (useVoiceInput) {
                           setCellState(cell, "voice_editing");
                        } else {
                           setCellState(cell, "typing");
                        }
                    });
                });

               // When users click the voiceInputToggle checkbox, update the cell state
               document.getElementById('voiceInputToggle').addEventListener('change', function() {
                  var useVoiceInput = document.getElementById('voiceInputToggle').checked;
                  if (useVoiceInput) {
                     setCellState(selected_cell, "voice_editing");
                  } else {                     
                     setCellState(selected_cell, "typing");
                  }
               });

            };
                      
                    
            </script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>
            <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
         </div>
      </section>
   </body>
</html>